
/* Find which team has won more matches and with more goals 
 ( Youtube : https://youtu.be/mb7GrJGCe24?si=31WORQ35Tqjmm8di)
*/

CREATE TABLE matches (
    match_id INT PRIMARY KEY,
    winning_team_id INT,
    losing_team_id INT,
    goals_won INT
);
delete from matches;
INSERT INTO matches (match_id, winning_team_id, losing_team_id, goals_won) VALUES
(1, 1001, 1007, 1),
(2, 1007, 1001, 2),
(3, 1006, 1003, 3),
(4, 1001, 1003, 1),
(5, 1007, 1001, 1),
(6, 1006, 1003, 2),
(7, 1006, 1001, 3),
(8, 1007, 1003, 5),
(9, 1001, 1003, 1),
(10, 1007, 1006, 2),
(11, 1006, 1003, 3),
(12, 1001, 1003, 4),
(13, 1001, 1006, 2),
(14, 1007, 1001, 4),
(15, 1006, 1007, 3),
(16, 1001, 1003, 3),
(17, 1001, 1007, 3),
(18, 1006, 1007, 2),
(19, 1003, 1001, 1);

-- For Second Test case
insert into matches values
(20, 1001, 1007, 3),
(21, 1001, 1003, 3);

select * from matches;

with cte as (
    select winning_team_id as team, 1 as points, goals_won from matches
    union all
    select losing_team_id as team, -1 as points, 0 as goals_won from matches
)
select 
    team, sum(points) as total_points, sum(goals_won) 
    from cte
    group by team
    order by total_points desc, sum(goals_won) desc
